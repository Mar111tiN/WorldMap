!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r(e.topojson=e.topojson||{})}(this,function(e){"use strict";var r=function(e){return e},t=function(e){if(null==e)return r;var t,n,o=e.scale[0],a=e.scale[1],c=e.translate[0],i=e.translate[1];return function(e,r){r||(t=n=0);var u=2,f=e.length,s=new Array(f);for(s[0]=(t+=e[0])*o+c,s[1]=(n+=e[1])*a+i;u<f;)s[u]=e[u],++u;return s}},n=function(e){var r,n=t(e.transform),o=1/0,a=o,c=-o,i=-o;function u(e){(e=n(e))[0]<o&&(o=e[0]),e[0]>c&&(c=e[0]),e[1]<a&&(a=e[1]),e[1]>i&&(i=e[1])}function f(e){switch(e.type){case"GeometryCollection":e.geometries.forEach(f);break;case"Point":u(e.coordinates);break;case"MultiPoint":e.coordinates.forEach(u)}}e.arcs.forEach(function(e){for(var r,t=-1,u=e.length;++t<u;)(r=n(e[t],t))[0]<o&&(o=r[0]),r[0]>c&&(c=r[0]),r[1]<a&&(a=r[1]),r[1]>i&&(i=r[1])});for(r in e.objects)f(e.objects[r]);return[o,a,c,i]},o=function(e,r){for(var t,n=e.length,o=n-r;o<--n;)t=e[o],e[o++]=e[n],e[n]=t};function a(e,r){var t=r.id,n=r.bbox,o=null==r.properties?{}:r.properties,a=c(e,r);return null==t&&null==n?{type:"Feature",properties:o,geometry:a}:null==n?{type:"Feature",id:t,properties:o,geometry:a}:{type:"Feature",id:t,bbox:n,properties:o,geometry:a}}function c(e,r){var n=t(e.transform),a=e.arcs;function c(e,r){r.length&&r.pop();for(var t=a[e<0?~e:e],c=0,i=t.length;c<i;++c)r.push(n(t[c],c));e<0&&o(r,i)}function i(e){return n(e)}function u(e){for(var r=[],t=0,n=e.length;t<n;++t)c(e[t],r);return r.length<2&&r.push(r[0]),r}function f(e){for(var r=u(e);r.length<4;)r.push(r[0]);return r}function s(e){return e.map(f)}return function e(r){var t,n=r.type;switch(n){case"GeometryCollection":return{type:n,geometries:r.geometries.map(e)};case"Point":t=i(r.coordinates);break;case"MultiPoint":t=r.coordinates.map(i);break;case"LineString":t=u(r.arcs);break;case"MultiLineString":t=r.arcs.map(u);break;case"Polygon":t=s(r.arcs);break;case"MultiPolygon":t=r.arcs.map(s);break;default:return null}return{type:n,coordinates:t}}(r)}var i=function(e,r){var t={},n={},o={},a=[],c=-1;function i(e,r){for(var n in e){var o=e[n];delete r[o.start],delete o.start,delete o.end,o.forEach(function(e){t[e<0?~e:e]=1}),a.push(o)}}return r.forEach(function(t,n){var o,a=e.arcs[t<0?~t:t];a.length<3&&!a[1][0]&&!a[1][1]&&(o=r[++c],r[c]=t,r[n]=o)}),r.forEach(function(r){var t,a,c=function(r){var t,n=e.arcs[r<0?~r:r],o=n[0];e.transform?(t=[0,0],n.forEach(function(e){t[0]+=e[0],t[1]+=e[1]})):t=n[n.length-1];return r<0?[t,o]:[o,t]}(r),i=c[0],u=c[1];if(t=o[i])if(delete o[t.end],t.push(r),t.end=u,a=n[u]){delete n[a.start];var f=a===t?t:t.concat(a);n[f.start=t.start]=o[f.end=a.end]=f}else n[t.start]=o[t.end]=t;else if(t=n[u])if(delete n[t.start],t.unshift(r),t.start=i,a=o[i]){delete o[a.end];var s=a===t?t:a.concat(t);n[s.start=a.start]=o[s.end=t.end]=s}else n[t.start]=o[t.end]=t;else n[(t=[r]).start=i]=o[t.end=u]=t}),i(o,n),i(n,o),r.forEach(function(e){t[e<0?~e:e]||a.push([e])}),a};function u(e,r,t){var n,o,a;if(arguments.length>1)n=function(e,r,t){var n,o=[],a=[];function c(e){var r=e<0?~e:e;(a[r]||(a[r]=[])).push({i:e,g:n})}function i(e){e.forEach(c)}function u(e){e.forEach(i)}return function e(r){switch(n=r,r.type){case"GeometryCollection":r.geometries.forEach(e);break;case"LineString":i(r.arcs);break;case"MultiLineString":case"Polygon":u(r.arcs);break;case"MultiPolygon":r.arcs.forEach(u)}}(r),a.forEach(null==t?function(e){o.push(e[0].i)}:function(e){t(e[0].g,e[e.length-1].g)&&o.push(e[0].i)}),o}(0,r,t);else for(o=0,n=new Array(a=e.arcs.length);o<a;++o)n[o]=o;return{type:"MultiLineString",arcs:i(e,n)}}function f(e,r){var t={},n=[],o=[];function a(e){e.forEach(function(r){r.forEach(function(r){(t[r=r<0?~r:r]||(t[r]=[])).push(e)})}),n.push(e)}function u(r){return function(e){for(var r,t=-1,n=e.length,o=e[n-1],a=0;++t<n;)r=o,o=e[t],a+=r[0]*o[1]-r[1]*o[0];return Math.abs(a)}(c(e,{type:"Polygon",arcs:[r]}).coordinates[0])}return r.forEach(function e(r){switch(r.type){case"GeometryCollection":r.geometries.forEach(e);break;case"Polygon":a(r.arcs);break;case"MultiPolygon":r.arcs.forEach(a)}}),n.forEach(function(e){if(!e._){var r=[],n=[e];for(e._=1,o.push(r);e=n.pop();)r.push(e),e.forEach(function(e){e.forEach(function(e){t[e<0?~e:e].forEach(function(e){e._||(e._=1,n.push(e))})})})}}),n.forEach(function(e){delete e._}),{type:"MultiPolygon",arcs:o.map(function(r){var n,o=[];if(r.forEach(function(e){e.forEach(function(e){e.forEach(function(e){t[e<0?~e:e].length<2&&o.push(e)})})}),(n=(o=i(e,o)).length)>1)for(var a,c,f=1,s=u(o[0]);f<n;++f)(a=u(o[f]))>s&&(c=o[0],o[0]=o[f],o[f]=c,s=a);return o})}}var s=function(e,r){for(var t=0,n=e.length;t<n;){var o=t+n>>>1;e[o]<r?t=o+1:n=o}return t},l=function(e){if(null==e)return r;var t,n,o=e.scale[0],a=e.scale[1],c=e.translate[0],i=e.translate[1];return function(e,r){r||(t=n=0);var u=2,f=e.length,s=new Array(f),l=Math.round((e[0]-c)/o),h=Math.round((e[1]-i)/a);for(s[0]=l-t,t=l,s[1]=h-n,n=h;u<f;)s[u]=e[u],++u;return s}};e.bbox=n,e.feature=function(e,r){return"GeometryCollection"===r.type?{type:"FeatureCollection",features:r.geometries.map(function(r){return a(e,r)})}:a(e,r)},e.mesh=function(e){return c(e,u.apply(this,arguments))},e.meshArcs=u,e.merge=function(e){return c(e,f.apply(this,arguments))},e.mergeArcs=f,e.neighbors=function(e){var r={},t=e.map(function(){return[]});function n(e,t){e.forEach(function(e){e<0&&(e=~e);var n=r[e];n?n.push(t):r[e]=[t]})}function o(e,r){e.forEach(function(e){n(e,r)})}var a={LineString:n,MultiLineString:o,Polygon:o,MultiPolygon:function(e,r){e.forEach(function(e){o(e,r)})}};e.forEach(function e(r,t){"GeometryCollection"===r.type?r.geometries.forEach(function(r){e(r,t)}):r.type in a&&a[r.type](r.arcs,t)});for(var c in r)for(var i=r[c],u=i.length,f=0;f<u;++f)for(var l=f+1;l<u;++l){var h,p=i[f],g=i[l];(h=t[p])[c=s(h,g)]!==g&&h.splice(c,0,g),(h=t[g])[c=s(h,p)]!==p&&h.splice(c,0,p)}return t},e.quantize=function(e,r){if(e.transform)throw new Error("already quantized");if(r&&r.scale)u=e.bbox;else{if(!((t=Math.floor(r))>=2))throw new Error("n must be â‰¥2");var t,o=(u=e.bbox||n(e))[0],a=u[1],c=u[2],i=u[3];r={scale:[c-o?(c-o)/(t-1):1,i-a?(i-a)/(t-1):1],translate:[o,a]}}var u,f,s=l(r),h=e.objects,p={};function g(e){return s(e)}function y(e){var r;switch(e.type){case"GeometryCollection":r={type:"GeometryCollection",geometries:e.geometries.map(y)};break;case"Point":r={type:"Point",coordinates:g(e.coordinates)};break;case"MultiPoint":r={type:"MultiPoint",coordinates:e.coordinates.map(g)};break;default:return e}return null!=e.id&&(r.id=e.id),null!=e.bbox&&(r.bbox=e.bbox),null!=e.properties&&(r.properties=e.properties),r}for(f in h)p[f]=y(h[f]);return{type:"Topology",bbox:u,transform:r,objects:p,arcs:e.arcs.map(function(e){var r,t=0,n=1,o=e.length,a=new Array(o);for(a[0]=s(e[0],0);++t<o;)((r=s(e[t],t))[0]||r[1])&&(a[n++]=r);return 1===n&&(a[n++]=[0,0]),a.length=n,a})}},e.transform=t,e.untransform=l,Object.defineProperty(e,"__esModule",{value:!0})});